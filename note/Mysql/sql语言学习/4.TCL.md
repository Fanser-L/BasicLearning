## TCL

全称 transaction control language 事务控制语言。

### 数据库事务

含义：通过一组逻辑操作单元，一组DML，将数据从一种状态切换到另一种状态。
特点：

    1.原子性：要么都执行，要么都回滚
    2.一致性：保证数据的状态操作前和操作状态后一致。
    3.多个事务操作数据库中同一个数据时，一个事务的执行不受另一个事务的干扰。
    4.一个事务一旦提交，则数据持久化到本地数据库，除非另一个事务对其进行修改。  

相关步骤：

    1.开启一个事务
    2.编写事务的一组逻辑操作单元
    3.提交事务或者回滚事务

### 事务的分类

隐式事务，没有明显的开始和结束事务的标志

    比如：insert update delete 本身就是一个事务

显示事务，有明显的开始和结束事务的标志

    1.开启事务
    取消自动提交事务的功能    set autocommit = false;
    2.编写事务的一组逻辑操作单元(多条sql语句)
    insert
    update
    delete
    3.提交事务或者回滚事务  commit; / rollback;

使用到的关键字：

    set autocommit = 0;
    start transacition;
    commit;
    rollback;
    
    savepoint; 断点
    commit to 断点
    rollback to 断点

事务的隔离级别：

事务并发问题如何发生？

    当多个事务操作同一个数据库的相同数据时发生。

事务的并发问题有哪些？

    脏读：一个事务读取到了另一个事务未提交的数据。
    不可重复读：同一个事务中，多次读取到的值不一致。
    幻读：一个事务读取数据时，另一个事务对数据进行了更新，第一个事务读取到了未更新的值。

1. 脏读：事务a对数据进行了修改，同时事务b也对同一数据进行了修改，然后a读取到了事务b修改后的数据，之后如果b对该事物进行了回滚，那将产生严重的问题，a读取的到的数据完全不准确，所以称为脏读。

2. 不可重复读： 事务a读取数据，事务b同时对该数据进行了修改，所以事务a再次对该数据读取后发现结果不一致，导致两次的读取不可重复。
3. 幻读是指当事务不是独立执行时发生的一种现象，例如第一个事务对一个表中的数据进行了修改，比如这种修改涉及到表中的“全部数据行”。同时，第二个事务也修改这个表中的数据，这种修改是向表中插入“一行新数据”。那么，以后就会发生操作第一个事务的用户发现表中还存在没有修改的数据行



如何避免事务的并发问题？

    通过设置事务的隔离级别
    1.read uncommitted 
    2.read commited             可以避免脏读
    3.repeatable read           可以避免脏读，不可重复读和一部分幻读
    4.serializable              可以避免脏读，不可重复读和幻读

设置隔离级别：

    set session |global  transaction isolation level1 隔离级别;

查看隔离级别：
    
    select @@tx_isolation;
